# Default total build time is 10m, which isn't always enough.
timeout: 1800s

############################################################################
# Create project-specific customized builder images.
############################################################################

steps:
# Build golang-cbif container. Useful golang builds and tests.
- name: gcr.io/cloud-builders/docker
  args: [
    'build', '--tag=gcr.io/$PROJECT_ID/golang-cbif',
    '--file=Dockerfile.golang', '.'
  ]

# Build gcloud-jsonnet-cbif image combining: gcloud, jsonnet, and cbif.
- name: gcr.io/cloud-builders/docker
  args: [
    'build',
    '--tag=gcr.io/$PROJECT_ID/gcloud-jsonnet-cbif',
    '--file=Dockerfile.jsonnet', '.'
  ]

# Build epoxy-images image
- name: gcr.io/cloud-builders/docker
  args: [
    'build',
    '--tag=gcr.io/$PROJECT_ID/epoxy-images',
    '--file=Dockerfile.epoxy-images', '.'
  ]

# Build siteinfo-cbif image. Used by siteinto repository builds.
- name: gcr.io/cloud-builders/docker
  args: [
    'build',
    '--tag=gcr.io/$PROJECT_ID/siteinfo-cbif',
    '--file=Dockerfile.siteinfo', '.'
  ]

images:
- 'gcr.io/$PROJECT_ID/golang-cbif:1.18'
- 'gcr.io/$PROJECT_ID/gcloud-jsonnet-cbif'
- 'gcr.io/$PROJECT_ID/epoxy-images'
- 'gcr.io/$PROJECT_ID/siteinfo-cbif'
